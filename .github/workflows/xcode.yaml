name: Xcode-clang

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

# Matrix with different Xcode versions

jobs:
  build:
    runs-on: macos-11

    strategy:
      matrix:
        xcode: [12.5.1, 13.0, 13.1, 13.2.1, 13.3.1, 13.4.1]

    steps:
      - uses: actions/checkout@v3
      - uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: ${{ matrix.xcode }}

      - name: Print toolchain versions
        run: |
          xcodebuild -version
          swift --version
          clang --version

      - name: Build (x86_64-apple-ios-macabi)
        run: |
          clang -target x86_64-apple-ios-macabi main.c

      - name: Build (x86_64-apple-ios14.0-macabi)
        run: |
          clang -target x86_64-apple-ios14.0-macabi main.c

      - name: Build (x86_64-apple-ios13.0-macabi)
        run: |
          clang -target x86_64-apple-ios13.0-macabi main.c
